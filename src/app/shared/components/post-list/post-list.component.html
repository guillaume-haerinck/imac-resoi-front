<div class="grid-horizontal-between">
    <h3 *ngIf="posts; else noPost">Posts ({{ posts.length }})</h3>
    <ng-template #noPost><h3>Posts</h3></ng-template>
    <button mat-raised-button *ngIf="currentState == postState.Read" color="accent" (click)="currentState = postState.Create">Ajouter un post</button>
</div>

<ng-container *ngIf="currentState == postState.Create">
    <ng-container *ngTemplateOutlet="form"></ng-container>
</ng-container>

<div *ngFor="let post of posts" class="post">
    <div *ngIf="postIdToUpdate != post.id">
        <div class="top-bar">
            <h3>{{ post.title }}</h3>
            <button mat-raised-button *ngIf="post.id_user == userId" (click)="currentState = postState.Update; postIdToUpdate = post.id; patchForm(post)">
                Modifier
            </button>
        </div>

        <p>{{ post.content }}</p>
        <p *ngIf="post.user">par {{ post.user.firstname }}</p>
    </div>

    <div *ngIf="postIdToUpdate == post.id">
        <ng-container *ngTemplateOutlet="form"></ng-container>
    </div>

    <div class="separator"></div>

    <h4>Commentaires</h4>
    <app-comment-list [comments]="post.comments" [eventId]="eventId" [postId]="post.id" (updated)="reloadComments()">
    </app-comment-list>
</div>

<ng-template #form>
    <form [formGroup]="postForm" id="postForm">
        <mat-form-field appearance="fill">
            <mat-label>Titre du post</mat-label>
            <input matInput placeholder="Concert au Crous" formControlName="title">
        </mat-form-field>

        <mat-form-field appearance="fill">
            <mat-label>Contenu du post</mat-label>
            <input matInput placeholder="Concert au Crous" formControlName="content">
        </mat-form-field>

        <ng-container [ngSwitch]="currentState">
            <button *ngSwitchCase="postState.Create" mat-raised-button color="accent" (click)="submitCreateForm()"
                [disabled]="!postForm.valid">
                Cr√©er
            </button>

            <ng-container *ngSwitchCase="postState.Update">
                <button mat-raised-button color="accent" (click)="submitEditForm()" [disabled]="!postForm.valid">
                    Modifier
                </button>
                <button mat-raised-button color="warn" (click)="deletePost()">
                    Supprimer
                </button>
            </ng-container>
        </ng-container>

        <button mat-button (click)="currentState = postState.Read; postIdToUpdate = undefined; patchForm(undefined)">
            Annuler
        </button>
    </form>
</ng-template>